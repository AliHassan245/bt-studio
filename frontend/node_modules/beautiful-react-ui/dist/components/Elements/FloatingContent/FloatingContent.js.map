{"version":3,"sources":["components/Elements/FloatingContent/FloatingContent.js"],"names":["FloatingContent","props","trigger","isShown","onToggle","action","placement","offset","clickOutsideToToggle","widthAsTrigger","reversePlacementOnSmallSpace","children","className","rest","triggerWrapperRef","contentWrapperRef","isFloatingContentShown","setFloatingContentIsShown","elementStyle","setElementStyle","mouseIsHovering","setMouseHover","derivedPlacement","setDerivedPlacement","recalculatePositionTimes","classList","calcPopupPosition","current","nextStyle","nextPlacement","contentWrapperRect","getBoundingClientRect","isThereEnoughSpace","undefined","JSON","stringify","clickOutsideHandler","target","contains","triggerWrapperRect","document","addEventListener","removeEventListener","onMouseEnter","onMouseLeave","actions","onClick","propTypes","PropTypes","node","isRequired","bool","func","oneOf","Placement","number","defaultProps","React","memo"],"mappings":"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","sourcesContent":["import React, { useRef, useEffect, useState } from 'react';\nimport { useWindowResize } from 'beautiful-react-hooks';\nimport classNames from 'classnames';\nimport PropTypes from 'prop-types';\nimport Portal from '../_Portal/Portal';\nimport { Placement, warn } from '../../../shared';\nimport getFloaterAbsolutePosition from './utils/getFloaterAbsolutePosition';\nimport checkAvailableSpace from './utils/checkAvailableSpace';\nimport getOppositePlacement from './utils/getOppositePlacement';\nimport checkAvailableSpaceByPlacement from './utils/checkAvailableSpaceByPlacement';\n\nimport './floating-content.scss';\n\n\n// @TODO: this component can be simplified quite a lot\n\n/**\n * A FloatingContent shows its own children components floating on a given trigger (possibly another React component).\n */\nconst FloatingContent = (props) => {\n  const {\n    trigger, isShown, onToggle, action, placement, offset, clickOutsideToToggle, widthAsTrigger,\n    reversePlacementOnSmallSpace, children, className, ...rest\n  } = props;\n  const triggerWrapperRef = useRef(null);\n  const contentWrapperRef = useRef(null);\n  const [isFloatingContentShown, setFloatingContentIsShown] = useState(true);\n  const [elementStyle, setElementStyle] = useState(null);\n  const [mouseIsHovering, setMouseHover] = useState(false);\n  /**\n   * the derivedPlacement state is required to void using a non fitting placement.\n   * It will contain a placement value opposite to the given one.\n   */\n  const [derivedPlacement, setDerivedPlacement] = useState(placement);\n  // use to check how many times the position has been recalculated\n  const recalculatePositionTimes = useRef(0);\n  const classList = classNames('bi bi-floater', { [`float-${derivedPlacement}`]: !!derivedPlacement }, className);\n\n  // Derives the component's position from the trigger's wrapper element then set it as elementStyle state.\n  const calcPopupPosition = () => {\n    if (isShown && triggerWrapperRef.current) {\n      const nextStyle = getFloaterAbsolutePosition(triggerWrapperRef.current, placement, offset, widthAsTrigger);\n      setDerivedPlacement(placement); // update placement status when placement change\n      setElementStyle(nextStyle);\n    }\n  };\n\n  // check if the rendered element has enough space in the viewport\n  useEffect(() => {\n    if (isShown && elementStyle) {\n      let nextPlacement = derivedPlacement;\n      const contentWrapperRect = contentWrapperRef.current ? contentWrapperRef.current.getBoundingClientRect() : null;\n      const isThereEnoughSpace = contentWrapperRect && checkAvailableSpace(contentWrapperRect);\n      if (reversePlacementOnSmallSpace && recalculatePositionTimes.current >= 2) {\n        setElementStyle(undefined);\n        setDerivedPlacement(undefined);\n        warn('It is impossible to show the content in the right position as there\\'s no enough space.');\n        return;\n      }\n      // if it is required to find the better position when there's no space to show the floating content\n      // eslint-disable-next-line max-len\n      if (reversePlacementOnSmallSpace && !isThereEnoughSpace && recalculatePositionTimes.current < 2 && contentWrapperRect) {\n        nextPlacement = getOppositePlacement(contentWrapperRect, nextPlacement);\n        const nextStyle = getFloaterAbsolutePosition(triggerWrapperRef.current, nextPlacement, offset, widthAsTrigger);\n        setElementStyle(nextStyle);\n        recalculatePositionTimes.current += 1;\n      }\n      setDerivedPlacement(nextPlacement);\n    }\n  }, [JSON.stringify(elementStyle)]);\n\n\n  useEffect(() => {\n    if (!isShown) {\n      setElementStyle(undefined);\n      setDerivedPlacement(placement);\n      recalculatePositionTimes.current = 0;\n      setFloatingContentIsShown(true);\n    }\n  }, [isShown]);\n\n  // handles the clicks outside the floating content (and outside the current trigger)\n  const clickOutsideHandler = ({ target }) => {\n    if (isShown\n      && (triggerWrapperRef.current && !triggerWrapperRef.current.contains(target))\n      && (contentWrapperRef.current && !contentWrapperRef.current.contains(target))) {\n      onToggle();\n    }\n  };\n\n  // recalculates the component's position when one of the following props change\n  useEffect(calcPopupPosition, [isShown, offset, placement, children]);\n\n  // recalculates the component's position on window resize\n  useWindowResize(() => {\n    if (contentWrapperRef.current) {\n      const contentWrapperRect = contentWrapperRef.current.getBoundingClientRect();\n      const triggerWrapperRect = triggerWrapperRef.current.getBoundingClientRect();\n      const isThereEnoughSpace = checkAvailableSpaceByPlacement(contentWrapperRect, triggerWrapperRect, placement);\n      if (isThereEnoughSpace) {\n        calcPopupPosition();\n      } else {\n        // eslint-disable-next-line max-len\n        const nextStyle = getFloaterAbsolutePosition(triggerWrapperRef.current, derivedPlacement, offset, widthAsTrigger);\n        setElementStyle(nextStyle);\n      }\n    }\n  });\n\n  // adds the click event listener when clickOutsideToToggle is true and when action is click\n  useEffect(() => {\n    if (triggerWrapperRef.current && contentWrapperRef.current && clickOutsideToToggle && action === 'click') {\n      document.addEventListener('click', clickOutsideHandler);\n    }\n\n    return () => {\n      document.removeEventListener('click', clickOutsideHandler);\n    };\n  }, [triggerWrapperRef.current, contentWrapperRef.current]);\n\n  /**\n   * onMouseEnter and onMouseLeave functions are both used to handle the hover action by toggling the\n   * mouseIsHovering state and firing the onToggle callback\n   */\n  const onMouseEnter = () => {\n    if (!mouseIsHovering) {\n      setMouseHover(true);\n      onToggle();\n    }\n  };\n\n  const onMouseLeave = () => {\n    if (mouseIsHovering) {\n      setMouseHover(false);\n      onToggle();\n    }\n  };\n\n  const actions = {\n    onClick: action === 'click' ? onToggle : undefined,\n    onMouseEnter: (action === 'hover') ? onMouseEnter : undefined,\n    onMouseLeave: action === 'hover' ? onMouseLeave : undefined,\n  };\n\n  return (\n    <>\n      {/* To easily access the trigger's position we wrap it within a referenced span */}\n      <span className=\"bi bi-float-trigger\" ref={triggerWrapperRef} role=\"complementary\" {...actions}>\n        {trigger}\n      </span>\n      {!isShown || !isFloatingContentShown ? null : (\n        <Portal id=\"bi-floats\">\n          {/* The floating content is shown within a Portal to avoid layout glitches */}\n          <div {...rest} className={classList} style={elementStyle} ref={contentWrapperRef}>\n            {children}\n          </div>\n        </Portal>\n      )}\n    </>\n  );\n};\n\nFloatingContent.propTypes = {\n  /**\n   * Defines the React node to apply the floating content to\n   */\n  trigger: PropTypes.node.isRequired,\n  /**\n   * Defines whether the floating content is shown or not\n   */\n  isShown: PropTypes.bool,\n  /**\n   * Defines the callback to be performed each time the event defined by the `action` prop fires,\n   * by default a `click` event\n   */\n  onToggle: PropTypes.func.isRequired,\n  /**\n   * Defines when to fire the onToggle callback, it can be `click` or `hover`\n   */\n  action: PropTypes.oneOf(['click', 'hover']),\n  /**\n   * If the `action` prop is set to `click`, it's possible to define if the `onToggle` callback should be performed\n   * when clicking outside of the trigger\n   */\n  clickOutsideToToggle: PropTypes.bool,\n  /**\n   * Defines the popup placement\n   */\n  placement: Placement,\n  /**\n   * Defines a number in pixel to possibly separate the popup from the trigger\n   */\n  offset: PropTypes.number,\n  /**\n   * Defines if the floating content should have the same width of its trigger\n   */\n  widthAsTrigger: PropTypes.bool,\n  /**\n   * Defines if the floating content placement must be reversed if there's not enough space to show it\n   */\n  reversePlacementOnSmallSpace: PropTypes.bool,\n};\n\nFloatingContent.defaultProps = {\n  isShown: false,\n  action: 'click',\n  clickOutsideToToggle: true,\n  placement: 'top-center',\n  offset: 0,\n  widthAsTrigger: false,\n  reversePlacementOnSmallSpace: true,\n};\n\nexport default React.memo(FloatingContent);\n"],"file":"FloatingContent.js"}