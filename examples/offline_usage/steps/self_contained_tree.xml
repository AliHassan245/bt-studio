<root>
    <BehaviorTree ID="MainTree">
        <ReactiveSequence name="rseq">
            <ReactiveFallback name="rfall">
                <CheckObstacle name="check_obstacle" name1="{same_key}" />
                <Turn name="avoid_obstacle" name2="{same_key}" />
            </ReactiveFallback>
            <Forward name="move_forward" speed="0.2" />
        </ReactiveSequence>
    </BehaviorTree>
    <Code>
        <Forward>
            import py_trees
            import geometry_msgs
            from py_gardener import gn_tools
            
            class Forward(py_trees.behaviour.Behaviour):
            
                def __init__(self, name: str = "Move", ports = None):
            
                    """Configure the name of the behaviour."""
                    super().__init__(name)
                    self.logger.debug("%s.__init__()" % (self.__class__.__name__))
            
                    # Store the ports in the class for later usage
                    self.ports = ports
            
                def setup(self, **kwargs) -&gt; None:
            
                    # Get the node passed from the tree (needed to interact with ros)
                    try:
                        self.node = kwargs['node']
                    except KeyError as e:
                        error_message = "didn't find 'node' in setup's kwargs [{}][{}]".format(self.qualified_name)
                        raise KeyError(error_message) from e  # 'direct cause' traceability
            
                    self.publisher = self.node.create_publisher(
                        msg_type=geometry_msgs.msg.Twist,
                        topic="/cmd_vel",
                        qos_profile=10
                    )
            
                def initialise(self) -&gt; None:
            
                    """Reset a counter variable."""
                    self.logger.debug("%s.initialise()" % (self.__class__.__name__))
            
                def update(self) -&gt; py_trees.common.Status:
            
                    msg = geometry_msgs.msg.Twist()
                    msg.linear.x = float(gn_tools.get_port_content(self.ports["speed"]))
                    self.publisher.publish(msg)
            
                    return py_trees.common.Status.RUNNING 
            
                def terminate(self, new_status: py_trees.common.Status) -&gt; None:
            
                    """Nothing to clean up in this example."""
                    msg = geometry_msgs.msg.Twist()
                    msg.linear.x = 0.0
                    self.publisher.publish(msg)
            
                    self.logger.debug(
            
                        "%s.terminate()[%s-&gt;%s]"
            
                        % (self.__class__.__name__, self.status, new_status)
            
                    )
        </Forward>
        <Turn>
            import py_trees
            import geometry_msgs
            import std_msgs
            from py_gardener import gn_tools
            
            class Turn(py_trees.behaviour.Behaviour):
            
                def __init__(self, name: str = "Turn", ports = None):
            
                    """Configure the name of the behaviour."""
                    super().__init__(name)
                    self.logger.debug("%s.__init__()" % (self.__class__.__name__))
                    self.ports = ports
            
                def setup(self, **kwargs: int) -&gt; None:
            
                    # Get the node passed from the tree
                    try:
                        self.node = kwargs['node']
                    except KeyError as e:
                        error_message = "didn't find 'node' in setup's kwargs [{}][{}]".format(self.qualified_name)
                        raise KeyError(error_message) from e  # 'direct cause' traceability
            
                    self.logger.debug("%s.setup()" % (self.__class__.__name__))
            
                    self.publisher = self.node.create_publisher(
                        msg_type=geometry_msgs.msg.Twist,
                        topic="/cmd_vel",
                        qos_profile=10
                    )
            
                    self.publisher2 = self.node.create_publisher(
                        msg_type=std_msgs.msg.String,
                        topic="/n_obs",
                        qos_profile=10
                    )
            
                    self.counter = 0
            
                def initialise(self) -&gt; None:
            
                    """Reset a counter variable."""
            
                    self.logger.debug("%s.initialise()" % (self.__class__.__name__))
            
                def update(self) -&gt; py_trees.common.Status:
            
                    msg = geometry_msgs.msg.Twist()
                    msg.angular.z = 0.4
                    self.publisher.publish(msg)
                    
                    nobs = gn_tools.get_port_content(self.ports["name2"])
                    str_pub = std_msgs.msg.String()
                    str_pub.data = str(nobs)
                    self.publisher2.publish(str_pub)
            
                    return py_trees.common.Status.RUNNING 
            
                def terminate(self, new_status: py_trees.common.Status) -&gt; None:
            
                    """Nothing to clean up in this example."""
            
                    self.logger.debug(
            
                        "%s.terminate()[%s-&gt;%s]"
            
                        % (self.__class__.__name__, self.status, new_status)
            
                    )
            
        </Turn>
        <CheckObstacle>
            import py_trees
            import sensor_msgs
            from ....translator import tools
            
            class CheckObstacle(py_trees.behaviour.Behaviour):
            
                def __init__(self, name: str = "CheckObstacle", ports = None):
            
                    """Configure the name of the behaviour."""
                    super().__init__(name)
                    self.logger.debug("%s.__init__()" % (self.__class__.__name__))
                    self.ports = ports
            
                def setup(self, **kwargs: int) -&gt; None:
            
                    # Get the node passed from the tree
                    try:
                        self.node = kwargs['node']
                    except KeyError as e:
                        error_message = "didn't find 'node' in setup's kwargs [{}][{}]".format(self.qualified_name)
                        raise KeyError(error_message) from e  # 'direct cause' traceability
            
                    self.subscription = self.node.create_subscription(
                        sensor_msgs.msg.LaserScan,
                        '/scan',
                        self.listener_callback,
                        10)
                
                    self.scan = sensor_msgs.msg.LaserScan()
                    self.counter = 0
            
                def initialise(self) -&gt; None:
            
                    """Reset a counter variable."""
                    self.logger.debug("%s.initialise()" % (self.__class__.__name__))
            
                def listener_callback(self, msg):
                    self.scan = msg
            
                def update(self) -&gt; py_trees.common.Status:
            
                    if len(self.scan.ranges) == 0: new_status = py_trees.common.Status.INVALID
                    elif self.scan.ranges[0] &gt; 1: 
                        self.counter += 1
                        try:
                            gn_tools.set_port_content(self.ports["name1"], self.counter)
                        except ValueError:
                            print("Unable to set port content")
                        new_status = py_trees.common.Status.SUCCESS
                    else: new_status = py_trees.common.Status.FAILURE
            
                    return new_status
            
                def terminate(self, new_status: py_trees.common.Status) -&gt; None:
            
                    """Nothing to clean up in this example."""
            
                    self.logger.debug(
            
                        "%s.terminate()[%s-&gt;%s]"
            
                        % (self.__class__.__name__, self.status, new_status)
            
                    )
            
        </CheckObstacle>
    </Code>
</root>